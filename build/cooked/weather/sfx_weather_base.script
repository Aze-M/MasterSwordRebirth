{ [shared]setvard game.effect.id weather_effect}{ [server] game_activatelocal FADE_IN PARAM1local WEATHER_TYPE PARAM2clientevent persist all GLOBAL_WEATHER FADE_IN WEATHER_TYPEsetvarg G_WEATHER_SCRIPT_ID game.script.last_sent_id}{ [server] worldevent_weather_die clientevent update all G_WEATHER_SCRIPT_ID weather_die PARAM1callevent PARAM1 effect_die}{ [server] effect_die dbg sv_weather effect_dieremovescript}#scope client{const WEATHER_CHANNEL const.snd.stream}{[client] const WIDTH 4500 setvard local.smlradius WIDTH divide local.smlradius 3 setvard local.medradius WIDTH divide local.medradius 2.5 setvard local.largeradius WIDTH const WEATHER_UPDATE_RATE 1 setvard local.dead 0}{[client] client_activatesetvard WEATHER_TYPE PARAM2setvard local.active 1setvard local.particle_chance 0setvard local.starttime game.timesetvard local.winduptime PARAM1local l.dirx $randf(-1,1)local l.diry $randf(-1,1)local l.dirz $randf(-1,0)setvard weather.wind.dir $dir($vec(0,0,0),$vec(l.dirx,l.diry,l.dirz))callevent weather_startcallevent weather_base_fade}{[client] weather_die setvard local.active 0 setvard local.starttime game.time setvard local.winduptime PARAM1setenv fog.enabled0 if( local.winduptime ) callevent weather_base_fade callevent local.winduptime weather_dead}{[client] weather_base_fade setvard local.amt game.time decvar local.amt local.starttime capvar local.amt 0 local.winduptime divide local.amt local.winduptime if( local.amt < 1 ) callevent WEATHER_UPDATE_RATE weather_base_fade if( !local.active ) { local L_WEATHER_AMT_OLD local.amtsetvard local.amt 1decvar local.amt L_WEATHER_AMT_OLD } setvard local.particle_chance local.amt multiply local.particle_chance 100 callevent weather_fade}{[client] weather_deadsetvard local.dead 1callevent baseweather_setenv 0removescript}{[client] base_particle_think repeatdelay $randf(0.05,0.2)  callevent base_create_particles local.smlradius SML_RADIUS_FREQ callevent base_create_particles local.medradius MED_RADIUS_FREQ callevent base_create_particles local.largeradius LGE_RADIUS_FREQ}{[client] base_create_particlescalleventloop PARAM2 base_create_particle_loop PARAM1}{[client] base_create_particle_loop if $rand(0,99) < local.particle_chancelocal l.radius PARAM1 local l.radiusneg $neg(l.radius)local x $rand(l.radiusneg,l.radius)local y $rand(l.radiusneg,l.radius)local l.pos $relpos(x,y,28) local l.skyheight $get_sky_height(l.pos) if l.skyheight isnot 'none'vectorset l.pos z l.skyheightcallevent create_particle l.pos}{ [client] environment_change if !local.deadcallevent baseweather_setenv 1}{ [client] client_activatecallevent baseweather_setenv 1}{ [client] baseweather_setenv if( PARAM1 ) callevent weather_setenvelse callexternal all environment_change clglobal.daystate }{ [client] weather_setenvlocal FOG_COLOR (1,1,1)local FOG_DENSITY 1.4local FOG_START 32local FOG_END 2048if ( WEATHER_TYPE equals fog_white ){setenv fog.enabled1setenv fog.colorFOG_COLORsetenv fog.densityFOG_DENSITYsetenv fog.startFOG_STARTsetenv fog.endFOG_ENDsetenv fog.typelinear}if ( WEATHER_TYPE equals fog_thick ){local FOG_DENSITY 5.4local FOG_START 50local FOG_END 500local FOG_COLOR (0.9,0.9,0.9)setenv fog.enabled1setenv fog.colorFOG_COLORsetenv fog.densityFOG_DENSITYsetenv fog.startFOG_STARTsetenv fog.endFOG_ENDsetenv fog.typelinear}if ( WEATHER_TYPE equals fog_green ){local FOG_COLOR (0,1,0)setenv fog.enabled1setenv fog.colorFOG_COLORsetenv fog.densityFOG_DENSITYsetenv fog.startFOG_STARTsetenv fog.endFOG_ENDsetenv fog.typelinear}if ( WEATHER_TYPE equals fog_red ){local FOG_COLOR (1,0,0)setenv fog.enabled1setenv fog.colorFOG_COLORsetenv fog.densityFOG_DENSITYsetenv fog.startFOG_STARTsetenv fog.endFOG_ENDsetenv fog.typelinear}if ( WEATHER_TYPE equals fog_blue ){local FOG_COLOR (0.8,0.8,1.0)setenv fog.enabled1setenv fog.colorFOG_COLORsetenv fog.densityFOG_DENSITYsetenv fog.startFOG_STARTsetenv fog.endFOG_ENDsetenv fog.typelinear}if ( WEATHER_TYPE equals fog_brown ){local FOG_COLOR (0.4,0.5,0.2)local FOG_DENSITY 5.4local FOG_START 50local FOG_END 500setenv fog.enabled1setenv fog.colorFOG_COLORsetenv fog.densityFOG_DENSITYsetenv fog.startFOG_STARTsetenv fog.endFOG_ENDsetenv fog.typelinear}if ( WEATHER_TYPE equals fog_black ){local FOG_COLOR (0.4,0.5,0.2)local FOG_DENSITY 5.4local FOG_START 50local FOG_END 500setenv fog.enabled1setenv fog.color(0.0,0,0.0,0.599)setenv fog.density1.5setenv fog.startFOG_STARTsetenv fog.endFOG_ENDsetenv fog.typelinear}}