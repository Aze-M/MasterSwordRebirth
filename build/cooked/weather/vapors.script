{const FREQ_CL_REFRESH 20.0}{ game_precacheprecachefile weathervapors_cl}{ game_spawnblood nonefly 1gravity 0nopush 1invincible 1setvard PLAYING_DEAD 1}{ game_postspawn if !AM_SUMMONEDsetvard PARAM_TOKENS PARAM4if ( $get_token_amt(PARAM_TOKENS) < 2 ){setvard ERROR_MODE 1}else{setvard VAPOR_COLOR $get_token(PARAM4,0)setvard VAPOR_SIZE $get_token(PARAM4,1)dbg Vapors - col: VAPOR_COLOR siz: VAPOR_SIZEif ( VAPOR_SIZE > 1024 ) setvard VAPOR_SIZE 1024if ( $get_token_amt(PARAM_TOKENS) > 2 ){setvard VAPOR_TYPE $get_token(PARAM4,2)if VAPOR_TYPE isnot nonesetvard VAPOR_DMG $get_token(PARAM4,3)if ( VAPOR_TYPE equals fire ){name a|burning foglocal VALID_LOOP 1}if ( VAPOR_TYPE equals poison ){name a|poisonus vaporlocal VALID_LOOP 1}if ( VAPOR_TYPE equals cold ){name an|icey cloudlocal VALID_LOOP 1setvard VAPOR_COLOR (128,128,255)}if VALID_LOOPcallevent 1.0 scan_victims}}if ( ERROR_MODE ) callevent error_loopif !ERROR_MODEsetvard IS_ACTIVE 1callevent start_fog}{ scan_victimsif $get(ent_me,isalive)callevent 1.0 scan_victimssetvard TARG_LIST $get_tsphere(player,VAPOR_SIZE,game.monster.origin)if TARG_LIST isnot nonecalleventloop $get_token_amt(TARG_LIST) attack_targets}{ attack_targetslocal CUR_TARGET $get_token(TARG_LIST,game.script.iteration)if ( VAPOR_TYPE equals fire ) applyeffect CUR_TARGET effectseffect_burn 5.0 $get(ent_me,id) VAPOR_DMGif ( VAPOR_TYPE equals poison ) applyeffect CUR_TARGET effectseffect_poison 5.0 $get(ent_me,id) VAPOR_DMGif ( VAPOR_TYPE equals cold ) applyeffect CUR_TARGET effectseffect_frostbite_dmg 5.0 $get(ent_me,id) VAPOR_DMG}{ start_fogif IS_ACTIVEcallevent FREQ_CL_REFRESH start_foglocal VAPOR_POS game.monster.originclientevent new all weathervapors_cl VAPOR_POS VAPOR_COLOR VAPOR_SIZE FREQ_CL_REFRESHsetvard CL_IDX game.script.last_sent_id}{ game_dynamically_createdsetvard AM_SUMMONED 1dbg Vapors - col: VAPOR_COLOR siz: VAPOR_SIZEsetvard VAPOR_COLOR PARAM1setvard VAPOR_SIZE PARAM2setvard VAPOR_TYPE PARAM3setvard VAPOR_DMG PARAM4if ( VAPOR_SIZE > 1024 ) setvard VAPOR_SIZE 1024callevent start_fog}{ error_loopif !AM_SUMMONEDinfomsg all "ERROR: weathervapors - wrong usage" "Use must define params property: (RRR,GGG,BBB);radius"callevent 10.0 error_loop}{ npc_suicideinvincible 0race hateddodamage ent_me direct 30000 100 GAME_MASTER target}{ game_removed callevent remove_cl_fx}{ game_deathcallevent remove_cl_fx}{ remove_cl_fxsetvard IS_ACTIVE 0clientevent update all CL_IDX end_fx}